<template>
    <div class="page">
        <div class="navbar">
            <div style="text-align: center; margin-top: 4px;"><img src="img/key.png" width="60px" /></div>
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" onclick="regresar();" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">Back</span>
                    </a>
                </div>
                <div class="right" style="margin-right: 15px">
                    <a href="#" data-popup=".demo-popup-excel" class="popup-open">
                        <i class="icon f7-icons if-not-md">help_round_fill</i>
                        <i class="icon material-icons if-md">help_outline</i>
                    </a>
                </div>
            </div>
        </div>

        <div class="popup demo-popup-excel">
        <div class="page">
            <div class="navbar">
                <div class="navbar-inner">
                    <div class="title" style="color: #a1a1a1">Ayuda</div>
                    <div class="right"><a href="#" class="link popup-close">Close</a></div>
                </div>
            </div>
            <div class="page-content">
                <div class="block">
                    <style type="text/css">
                      h2 {color: #222; text-align: center;}
                      .all {font-size: 10pt;color: #222; text-align: justify;}
                      hr {
                              border:none;
                              height: 20px;
                                width: 90%;
                                height: 50px;
                                margin-top: 0;
                                border-bottom: 1px solid #17202A;
                                box-shadow: 0 20px 20px -20px #2E9AFE;
                              margin: -50px auto 10px;
                            }
                    </style>
                    <center>
                        <span style="color:#00008B; font-size: 20pt"><strong>Programa de visitas</strong></span>
                    </center>
                    <hr width="90%">
                    <span class="all">
                        <span>En esta pantalla contamos con una tabla, la cual nos dara informaci√≥n sobre los clientes y las visitas que se tienen que realizar.<br>
                         <font color="#a90000"><span><strong>NOTA:</strong></font>Esta tabla se llena de acuerdo a usuario y sus rutas predeterminadas.</span>
                         <br>
                        <span>Ejemplo:</span><br>
                        <center><img src="img/ayuda/tablaVisitas.png" width="60%"></center>
                        <br>
                        Esta tabla tambien cuenta con un sistema como el de un <font color="#1e90ff">semaforo</font>.<br>
                        Ya que nos pintara de  <font color="#00b455">verde</font>, <font color="#b3b300">amarillo</font>  y <font color="#900f0f">rojo</font> dependiendo cuantas veces ya hayamos visitado al mismo cliente.
                        <br>
                        <span><strong>- Verde:</strong></span> Cuando ya hayamos cumplido las visitas requeridas.<br>
                        <span><strong>- Amarillo:</strong></span> Cuando vayamos a la mitad de las visitas requeridas.<br>
                        <span><strong>- Rojo:</strong></span> Cuando aun no tengamos ninguna de las visitas requeridas.<br>

                        <span style="color:#a1a1a1;font-size: 9pt;text-align: justify;">Imagen de referecia:</span><br>
                        <center><img src="img/ayuda/tablaVisitasSemaforo.png" width="60%"></center>

                    </span>
                </div>
            </div>
        </div>
    </div>


        <div class="page-content">
            <div style="text-align: center; justify-content:center; margin-right:auto; margin-left:auto; width: 99%;">
                <h2 style="color:#00008B;">Programa de visitas</h2>
                <hr>
                <table id="falta" align="center" style="width: 50%;">
                    <th colspan="3">Resumen total</th>
                    <tr>
                        <td>Total pogramadas</td>
                        <td>Total realizadas</td>
                        <td>Visitas faltantes</td>
                    </tr>
                    <tbody id="faltantes">
                        <tr>
                            <td id="TotalC"></td>
                            <td id="RelizadasC"></td>
                            <td id="FaltantesC"></td>
                        </tr>
                    </tbody>
                </table>

                <div class="page-content infinite-scroll-content infinite-scroll-top">
                    <style type="text/css">
                        #encabezado1{background-color: #3590FA;color: white; font-weight: bold;}
                        #encabezado2{font-weight: bold;}
                        #encabezado3{background-color: #3590FA;color: white; font-weight: bold;}
                        #encabezado4{background-color: #3590FA;color: white; font-weight: bold;}
                    </style>
                    <div class="list sortable">
                        <ul id="rutas">
                            <li>
                                <div id="encabezado1" class='item-content'>
                                    <div class='item-inner'>
                                        <div id="encabezado2" class='item-title'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cliente</div>
                                        <div id="encabezado3" class='item-after'>Programadas&nbsp;&nbsp;Realizadas</div>
                                    </div>
                                </div>
                            </li>
                            <!--<li>
                                <div class='item-content'>
                                    <div class='item-inner'>
                                        <div class='item-after'><strong>1234</strong>&nbsp;&nbsp;&nbsp;&nbsp;</div>
                                        <div class='item-title'>Esto es una prueba para ver cuando el nombre salga largo</div>
                                        <div class='item-after' style="height: 100%;"><label style='background-color: #00b455;  border: white 2px solid; color:#fff; display: inline-flex;border-collapse:collapse; border-style: solid; border-width: 2px;align-items:center;justify-content: center;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class='item-content'>
                                    <div class='item-inner'>
                                        <div class='item-after'><strong>1210</strong>&nbsp;&nbsp;&nbsp;&nbsp;</div>
                                        <div class='item-title'>Restaurante toks perisur sa de cv.</div>
                                        <div class='item-after' style="height: 100%;"><label style='background-color: #900f0f;  border: white 2px solid; color:#fff; display: inline-flex;border-collapse:collapse; border-style: solid; border-width: 2px;align-items:center;justify-content: center;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                            </li>-->
                        </ul>
                    </div>
                    <div class="preloader infinite-scroll-preloader"></div>
                    <div id="preloader2"></div>
                </div>
<!--
                <div class="card data-table">
                    <table id="tablaExcel" style="width:98%;">
                        <header>
                            <style>
                                table {
                                  border-collapse: collapse;
                                  width: 100%;
                                }

                                th, td {
                                  text-align: center;
                                  padding: 8px;
                                }

                                tr:nth-child(even){background-color: #f2f2f2}

                                th {
                                  background-color: #3590FA;
                                  color: white;
                                }
                              </style>
                        </header>
                        <tr>
                            <th>Cliente</th>
                            <th>Programadas</th>
                            <th>Realizadas</th>
                        </tr>
                        <tbody id="listaExcel">

                        </tbody>
                    </table>
                <div class='sentencia preloader color-blue infinite-scroll-preloader'></div>
                </div>
            </div>-->

        </div>
    </div>
</template>
<script>
    return {
        on: {
          pageInit: function (e, page) {
                var IdU = localStorage.getItem("IdUsuario");
                app.request.get('http://www.appbennetts.com/VIC/ProcesosVIC7/RutasResumen.php', { IdUsuario: IdU}, function (data) {
                    var content = JSON.parse(data);
                    for(var e=0; e < content.length; e++){
                        var VisitasProgramadas = content[e].VisitasProgramadas;
                        var Realizadas = content[e].Realizadas;
                        var Faltantes = parseInt(VisitasProgramadas) - parseInt(Realizadas);

                        $('#TotalC').append(VisitasProgramadas);
                        $('#RelizadasC').append(Realizadas);
                        $('#FaltantesC').append(Faltantes)
                     }
                });

                //infinite scroll
                var $$ = Dom7;
                var allowInfinite = true;
                var lastItemIndex = $$('.list sortable li').length;
                var maxItems = 200;
                var itemsPerLoad = 10;
                $$('.infinite-scroll-content').on('infinite', function () {
                    if (!allowInfinite) return;
                    allowInfinite = false;
                    setTimeout(function () {
                    allowInfinite = true;
                    if (lastItemIndex >= maxItems) {
                      app.infiniteScroll.destroy('.infinite-scroll-content');
                      $$('.infinite-scroll-preloader').remove();
                      return;
                    }
                    var html ='';
                    for (var i = lastItemIndex + 1; i <= lastItemIndex + itemsPerLoad; i++) {}
                        $$('#rutas').append(html);
                    $('.preloader').remove();
                    $('.infinite-scroll-preloader').remove();
                    lastItemIndex = $$('.list sortable li').length;
                  }, 1000);
                });


                        app.request.get('http://www.appbennetts.com/VIC/ProcesosVIC7/UsuarioExcel.php', { IdUsuario: IdU}, function (data) {
                            var content = JSON.parse(data);
                            for(var e=0; e < content.length; e++){
                                var res = content[e].NoVisitasProgramadas / 2;
                                var resultado = Math.round(res);
                                //VERDE
                                if(content[e].NoVisitasProgramadas == content[e].NoRealizadas || content[e].NoRealizadas > content[e].NoVisitasProgramadas){
                                    $('#rutas').append("<li><div class='item-content'><div class='item-inner'><div class='item-after'><strong>" + content[e].NumeroCliente+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='item-title'>"+content[e].Cliente+"</div><div class='item-after' style='height: 100%;'><label style='background-color: #00b455;  border: white 2px solid; color:#fff; display: inline-flex;border-collapse:collapse; border-style: solid; border-width: 2px;align-items:center;justify-content: center;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoVisitasProgramadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoRealizadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label></div></div></div></li>");


                                }else if(resultado == content[e].NoVisitasProgramadas || resultado < content[e].NoVisitasProgramadas && resultado > content[e].NoRealizadas){
                                    $('#rutas').append("<li><div class='item-content'><div class='item-inner'><div class='item-after'><strong>" + content[e].NumeroCliente+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='item-title'>"+content[e].Cliente+"</div><div class='item-after' style='height: 100%;'><label style='background-color: #900f0f;  border: white 2px solid; color:#fff; display: inline-flex;border-collapse:collapse; border-style: solid; border-width: 2px;align-items:center;justify-content: center;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoVisitasProgramadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoRealizadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label></div></div></div></li>");
                                }else{
                                    $('#rutas').append("<li><div class='item-content'><div class='item-inner'><div class='item-after'><strong>" + content[e].NumeroCliente+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='item-title'>"+content[e].Cliente+"</div><div class='item-after' style='height: 100%;'><label style='background-color: #b3b300;  border: white 2px solid; color:#fff; display: inline-flex;border-collapse:collapse; border-style: solid; border-width: 2px;align-items:center;justify-content: center;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoVisitasProgramadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+content[e].NoRealizadas+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label></div></div></div></li>");
                                }
                                $('.preloader').remove();
                                $('.infinite-scroll-preloader').remove();
                            }
                        });

            }
        }
    }
</script>
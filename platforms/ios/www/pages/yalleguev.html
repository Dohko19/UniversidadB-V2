<template>
    <div class="page">
        <div class="navbar">
            <div style="text-align: center; margin-top: 4px;"><img src="img/key.png" width="60px" /></div>
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">Back</span>
                    </a>
                </div>
                <div class="right" style="margin-right: 15px">
                    <a href="#" data-popup=".demo-popup-llegue" class="popup-open">
                        <i class="icon f7-icons if-not-md">help_round_fill</i>
                        <i class="icon material-icons if-md">help_outline</i>
                    </a>
                </div>
            </div>
        </div>

        <div class="popup demo-popup-llegue">
          <div class="page">
            <div class="navbar">
              <div class="navbar-inner">
                <div class="title" style="color: #a1a1a1">Ayuda</div>
                <div class="right"><a href="#" class="link popup-close">Close</a></div>
              </div>
            </div>
            <div class="page-content">
              <div class="block">

                <style type="text/css">
                  h2 {color: #222; text-align: center;}
                  .all {font-size: 10pt;color: #222; }
                  ul {list-style-type: circle;}
                </style>
                <center>
                    <span style="color:#00008B; font-size: 20pt"><strong>¡Ya Llegue!</strong></span><br>
                    <span style="color:#a1a1a1;font-size: 9pt;">(Valido para visita VIC y Visita Apoyo)</span>
                </center>
                <hr width="90%">
                <span class="all">
                        <li>En esta pantalla se te pide la fotografía obligatoria que se debera tomar en el lugar donde se realiza la visita.<br />
                            <center><img src="img/cam.png" width="30px"></center>
                        </li><br /><br />
                        <li>Para el caso del campo "Proyecto", se tiene que <font color="#1e90ff"><strong>seleccionar una opcion (Proyecto) </strong></font>. <br />
                        <center><img src="img/ayuda/seleccionarproyecto.png" width="70%"></center>
                        Se debe tomar en cuenta que en caso de que <strong>no haya proyectos cargados</strong> o se necesite <strong>agregar un nuevo proyecto</strong> es necesario dar clic en el signo de mas<br /><br />
                            <center><img src="img/ayuda/signomas1.png" width="20%"></center>
                        </li><br /><br />
                        <li>
                            Mostrara la siguiente ventana donde debemos colocar el <strong>nombre del proyecto</strong>, clic en guardar, mostrara un mensaje donde indicara que el proyecto se agrego al listado, cerrar esta ventana.
                            <center><img src="img/ayuda/agregarproyecto.png" width="70%">&nbsp;&nbsp;&nbsp;<img src="img/ayuda/alertproyecto.png" width="70%"></center>
                        </li>
                        <li>
                        Por ultimo solo debes seleccionar el proyecto, guardar el registo.
                        <center><img src="img/ayuda/seleccionarproyecto.png" width="70%"></center>
                        </li>

                </span>

              </div>
            </div>
          </div>
        </div>
        <!-- ALTA DE NUEVO PROYECTO -->
        <div class="fab fab-center-bottom fab-morph" data-morph-to=".demo-fab-fullscreen-sheet.fab-morph-target">
          <a href="#">
            <i class="icon f7-icons if-not-md">add</i>
            <i class="icon material-icons md-only">add</i>
          </a>
        </div>
        <div class="demo-fab-fullscreen-sheet fab-morph-target">
            <div style="text-align: right; width:90%;"><br /><a href="#" class="fab-close">Cerrar</a></div>
            <h3 style="color:#00008B; text-align: center;">Agregar Proyecto</h3>

            <form class="list" id="demo-form">
                <div style="width:85%; margin: 0 auto; border-collapse: collapse;">
                    <span class="span" style="font-weight: bold; font-size: 18px;">Nombre del nuevo proyecto:</span>
                    <span id="text2">
                        <input type='text' id="NomNvoP" name="NomNvoP" placeholder='Nombre del nuevo proyecto:'  />
                    </span>
                    <!--POTENCIAL -->
                    <span class="span" style="font-weight: bold; font-size: 18px;">Potencial:</span>
                    <span id="text2">
                        <input type='Number' id="Potencial" name="Potencial" placeholder='Potencial:'  />
                    </span>

                    <!--SEGMENTO-->
                    <span class="span" style="font-weight: bold; font-size: 18px;">Segmento:</span>
                    <a class="item-link smart-select smart-select-init" data-open-in="popup"  data-searchbar-placeholder="Segmento">
                        <select name="SegmentoProyecto"  id="SegmentoProyecto" class="span">
                                <option value="0">Seleccione un segmento...</option>
                        </select>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title"></div>
                            </div>
                        </div>
                    </a>

                    <br>
                    <br>
                    <table style="width:100%; margin: 0 auto; text-align: center;  border-collapse: collapse;">
                        <tr>
                            <td>
                                <a href="#" onclick="gProyecto();" style="border: none; outline:none;"><img src="img/save2.png" width="40px" /></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </div>
        <!-- FIN DE ALTA DE NUEVO PROYECTO -->
        <div class="page-content">
            <div style="text-align: center; justify-content:center; margin-right:auto; margin-left:auto; width: 99%;">

                <h2 style="color:#00008B;">Visita de ventas</h2>

                <form class="list" id="demo-form">
                    <input type="hidden" id="imagenC" name="imagenC"/>
                    <span style="font-weight: bold; color: #8B0000;">¡Ya llegué!</span><br />
                    <a href="#" style="background-color: white; border: none; outline:none; width: 15%;" onclick="capturePhoto();"><img src="img/cam.png" width="40px" /></a>
                    <br />
                    <input type="image" name="smallImage" style="display:none; margin: 0 auto;margin: 0 auto; width:90px; height:120px;" id="smallImage" src="" />
                    <div hidden="true" id="ImaCe" hidden="true"></div>

                    <br />
                    <span class="span" style="font-weight: bold;">Proyecto:</span>

                        <a class="item-link smart-select smart-select-init" data-open-in="popup"  data-searchbar-placeholder="Descripcion">
                            <select name="actividades" id="actividades" class="spanBlanco">
                                <option value="0">Seleccione una opci&oacute;n</option>
                            </select>
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title"></div>
                                </div>
                            </div>
                        </a>

                    <input type='hidden' name="geolocation" id="geolocation" placeholder='Geolocalización...' disabled="disabled"/>
                    <br /><br />
                    <a href="#" onclick="gVentas();" style="border: none; outline:none;"><img src="img/save2.png" width="35px" height="35px" /></a>
                    <br /><br />
                </form>
            </div>
        </div>
    </div>
</template>
<script>
return {
    on: {
      pageInit: function () {
        var self = this;
        var app = self.$app;
        // Dropdown with ajax data
        var OPCV = localStorage.getItem("Opcion");
        var IdUsu = localStorage.getItem("IdUsuario");

        //Agregar columnas potencial y segmento
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "ALTER TABLE Proyectos ADD Potencial integer",
                    [],
                    function(tx5, results){

                    }
                );
            },
            function(error){},
            function(){}
        );
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "ALTER TABLE Proyectos ADD SegmentoProyecto text",
                    [],
                    function(tx5, results){

                    }
                );
            },
            function(error){},
            function(){}
        );

        //Llenar select de segmentos ---------
        app.request.get(cordova.file.externalRootDirectory + '/jsons/Segmentos.json', function (data) {
            var content = JSON.parse(data);
            select = document.getElementById("SegmentoProyecto");
            for(var i=0; i < content.length; i++){
                option = document.createElement("option");
                option.value = content[i].id_segmercado;
                option.text = unescape(content[i].seg_mercado);
                select.appendChild(option);
            }
        });

        //Fin llenar segmentos


        //Llenar el select de los productos
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "SELECT * FROM Proyectos where IdUsuario = ?",
                    [IdUsu],
                    function(tx5, results){
                        var length = results.rows.length;
                        select = document.getElementById("actividades");
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);
                            option = document.createElement("option");
                            option.value = item2.IdProyecto;
                            option.text = unescape(item2.NombreProyecto);
                            select.appendChild(option);

                        }
                    },
                    function(tx5, error){
                        console.log("Error al mostrar los proyectos: " + error.message);
                    }
                );
            },
            function(error){},
            function(){}
        );//Fin de select


        var select = document.getElementById('actividades');
        select.addEventListener('change',
          function(){
            var selectedOption = this.options[select.selectedIndex];

            localStorage.setItem("NombreProyecto", selectedOption.text);
          });

        //cargar el contenido cad ves que entre aqui
            document.addEventListener("deviceready", onDeviceReady, false);
            function onDeviceReady() {
                navigator.geolocation.getCurrentPosition(onSuccess, onError);
            }
            function onSuccess(position) {
                var element = document.getElementById('geolocation');
                $('#geolocation').val(position.coords.latitude+','+position.coords.longitude);
            }
            function onError(error) {
                alert('Error en la Localización');
            }


            //Verificar GPS
            cordova.plugins.diagnostic.isGpsLocationEnabled(function(enabled){
                console.log("GPS location is " + (enabled ? "enabled" : "disabled"));
                if(enabled == true){

                }else{
                    app.dialog.alert('Favor de encender tu GPS.','Aviso!');
                }

            }, function(error){
                console.error("The following error occurred: "+error);
            });


        }
    }
}
</script>
<template>
  <div class="view view-main view-init safe-areas">
  <div class="page">
  <div class="navbar">
    <div class="navbar-inner sliding">
      <div class="left">
        <a href="#" class="link back">
          <i class="icon icon-back"></i>
          <span class="if-not-md">Back</span>
        </a>
      </div>
      <div class="title">Cierre con el Cliente</div>
    </div>
  </div>
  <div class="toolbar toolbar-bottom tabbar">
    <font size="1">
      <div class="toolbar-inner">
        <a href="#tab-1" class="tab-link tab-link-active" style="font-size: 16px;">Cliente</a>
        <a href="#tab-2" class="tab-link" style="font-size: 16px;">Recorrido</a>
        <a href="#tab-3" class="tab-link" style="font-size: 16px;">Cierre</a>
      </div>
    </font>
  </div>
  <div class="tabs-animated-wrap">
    <div class="tabs">
      <div id="tab-1" class="page-content tab tab-active">
        <div class="block">
          <div style="text-align: center; justify-content:center; margin-right:auto; margin-left:auto; width: 99%;">
            <h2 style="color:#00008B;">Datos Generales</h2>
            <p>   
              <span style="color: #9DC7F8; font-weight: bold;" id ="num"> </span> 
              <span style="color: #9DC7F8;"> - </span> 
              <span style="color: #9DC7F8; font-weight: bold;" id ="cli"></span>
            </p>
          </div>
            <div style="text-align: left; justify-content:left; margin-right:auto; margin-left:auto; width: 99%;">
            <div class="infinite-scroll-content">
            <div class='sentencia1 preloader color-red infinite-scroll-preloader'></div>
                </div>
              <table id = "imyal" cellpadding="10" >
                
                <tbody id="imya">
                  <tr>
                    <th>Nombre comercial:</th>
                    <td><span id ="nomcom"></span></td>
                  </tr>
                  <tr>
                    <th>Contacto:</th>
                    <td><span id ="contac"></span></td>
                  </tr>
                  <tr>
                    <th>Teléfono:</th>
                    <td><span id ="tel"></span></td>
                  </tr>
                  <tr>
                    <th>Email:</th>
                    <td><span id ="email"></span></td>
                  </tr>
                  <tr>
                    <th>Estatus:</th>
                    <td><span id ="estat"></span></td>
                  </tr>
                  <tr>
                    <th>Imagen:</th>
                    <td><span id ="imagya"></span></td>
                  </tr>
                  
                  
                  </tbody>
              </table>
            </div>
          </div>
      </div>
      

      <div id="tab-2" class="page-content tab">
       
       <div class="block-title" style="text-align: center;">Equipos</div>
        <div class="infinite-scroll-content">
            <div id="FEquipos">
            </div>
            <div class='sentencia2 preloader color-red infinite-scroll-preloader'></div>
                </div>
       <div class="block-title" style="text-align: center;">Imagen</div>
       <div class="infinite-scroll-content">
            
            <div id="FImagen">
            </div>
            <div class='sentencia3 preloader color-red infinite-scroll-preloader'></div>
                </div>
       <div class="block-title" style="text-align: center;">Entrenamiento</div>
       <div class="infinite-scroll-content">
            <div id="FEntrenamiento">
            </div>
            <div class='sentencia4 preloader color-red infinite-scroll-preloader'></div>
                </div>
       <div class="block-title" style="text-align: center;">Almacén</div>
        <div class="infinite-scroll-content">
          <div id="FAlmacen"></div>
          <div class='sentencia5 preloader color-red infinite-scroll-preloader'></div>
        </div>
       <div class="block-title"><strong>Pedido</strong></div>
        <div class="infinite-scroll-content">
          <div id ="FPedidoCheck"></div>
          <div class='sentencia5 preloader color-red infinite-scroll-preloader'></div>
        </div>
          <div class="card data-table" >
              <div class="infinite-scroll-content">
                  <table id="TabProductos2">
                      <thead>
                          <tr>
                              <th class="numeric-cell">Código</th>
                              <th class="numeric-cell">Descripción</th>
                              <th class="numeric-cell">Inventario al dia</th>
                              <th class="numeric-cell">Cantidad Solicitada</th>
                              <th class="numeric-cell">Comentario</th>
                          </tr>
                      </thead>
                      <tbody id="IProd">
                      
                      </tbody>
                  </table>
              
              <div class='sentencia6 preloader color-red infinite-scroll-preloader'></div>
          </div>
        </div>

        <div class="block-title">Observaciones (Pedido)</div>
        <div class="card">
          <div class="card-content card-content-padding" id="ObserPe"></div>
        </div>

        <div class="block-title"><strong>Cotización de nuevos productos</strong></div>
          <div class="card data-table">
          <div class="infinite-scroll-content">
                    <table id ="tablaPNvo1">
                        <thead>
                            <tr>
                                <th class="numeric-cell">Código</th>
                                <th class="numeric-cell">Descripción</th>
                                <th class="numeric-cell">Uso</th>
                            </tr>
                        </thead>
                        <tbody id="prodNew1">
                    
                    
                        </tbody>
                    </table>
                    <div class='sentencia7 preloader color-red infinite-scroll-preloader'></div>
                </div>
                </div>
          <br /><br/>
     </div>
      

      <!--------------------------------FIN TAB 3-->
      <div id="tab-3" class="page-content tab">
        <div class="block">
        <div style="text-align: center; justify-content:center; margin-right:auto; margin-left:auto; width: 99%;">
            <h2 style="color:#00008B;">Cierre con el Cliente</h2>
          <p>
          <div id="adios">
            <label style="font-size: 20px; font-weight: bold; color: #8B0000;">Recomendaciones de imagen</label>
          </p>
          <br />
          <div id="imgCte" >
          
          </div>
          <br /> 
          <div class="card data-table" id="evaluacion">
          <div class="infinite-scroll-content">
                <table id ="tabEval">
                    <thead>
                        <tr>
                          <th colspan='4' style='background-color: #83c6dd; color: black; text-align: center;'>Evaluación de apertura</th>
                        </tr>
                        <tr>
                            <th class="numeric-cell" style="background-color: #D6D6D6; color: black; text-align: center">Riesgos Criticos</th>
                            <th class="numeric-cell" style="background-color: #D6D6D6; color: black; text-align: center">Riesgos Inminentes</th>
                        </tr>
                    </thead>
                    <tbody id="Eval1">
                    </tbody>
                </table>
                <div class='sentencia7 preloader color-red infinite-scroll-preloader'></div>
            </div>
          </div>

          <p>
            <label style="font-size: 20px;"><strong>Nombre y firma</strong></label>
          </p>

            <center><input style="display: block;margin: 0 auto;width: 100%;border: 0;border-bottom: 1px solid rgba(0,0,0,.2);height: 35px;line-height: 45px;  margin-bottom: 10px;font-size: 1em;" class="spanBlanco" type="text" name="NombreFirma" id="NombreFirma" placeholder="Nombre:"></center><br/>

            <input type="hidden" name="signate" id="signate" placeholder="sfirmc"/> 
            <center><img id="ImagenFirmaView" src="" width="70%"><br>
            <span id="VolverFirmar"></span></center>
            <a class="link popup-open" href="#" onclick="landsca();" data-popup=".popup-services"><img src="img/NewDesingComplements/circuloFirmaColor.png" width="80px" /></a><br /><br />
              <div class="popup popup-services">
                  <br />
                  <a class="link popup-close" onclick="gfirma();" href="#">Guardar Firma</a>
                  <div id="signatureparent">
                      <div id="signature"></div>&nbsp;<br>
                  </div>
              </div>
            <p>
            <label style="font-size: 20px;"><strong>Solicitar estado de cuenta </strong><br />
            <input class ="cambio" type="radio" name="estado" id="estado1" value="si" />SI &nbsp; &nbsp; 
            <input class ="cambio" type="radio" name="estado" id="estado2" value="no" checked/>NO <br /></label>
            <div class="cuenta" hidden="">
              <label style="font-size: 15px;"><strong>Nombre de la persona:</strong><br />
              <center><input style="display: block;margin: 0 auto;width: 100%;border: 0;border-bottom: 1px solid rgba(0,0,0,.2);height: 35px;line-height: 45px;  margin-bottom: 10px;font-size: 1em;" class="spanBlanco" type="text" name="NombreCuenta" id="NombreCuenta" placeholder="Nombre de la persona:"></center><br/>
              <label style="font-size: 15px;"><strong>Correo de la persona:</strong><br />
              <center><input style="display: block;margin: 0 auto;width: 100%;border: 0;border-bottom: 1px solid rgba(0,0,0,.2);height: 35px;line-height: 45px;  margin-bottom: 10px;font-size: 1em;" class="spanBlanco" type="text" name="CorreoCuenta" id="CorreoCuenta" placeholder="ejemplo@ejemplo.com"></center><br/>
            </div><br>

            <label style="font-size: 20px;"><strong>Evalue nuestro servicio</strong></label><br />
            <span class="rating big-blue"></span>
            <input type="hidden" name="eval" id="eval" />
          
            <br />  
            <input id="text2" name="comencte" placeholder="¿Porqué coloco esa calificacion?" />
          </p>
          <input type='hidden' name="geolocation" id="geolocation" placeholder='Geolocalización...' disabled="disabled"/>
        <h4 style="color:#8B0000;">Nota: El<span style="font-weight: bold; text-decoration-line: underline;"> Cliente</span> deberá dar click en "Guardar" una vez realizada la firma y la evaluación.</h4>
            <a href="#" onclick="gcierre();" style="border: none; outline:none;"><img src="img/save2.png" width="50px" /></a>            
        </div> <!-- DATOS -->
        </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</template>
<script>
  return {
    on: {
      pageInit: function (e, page) {

        var IdCte = localStorage.getItem("IdCte");
        var icedula = localStorage.getItem("IdCedula");

        //Agregar columnas nombre y correo para Estado de cuenta
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "ALTER TABLE cierre ADD NombreCuenta text",
                    [],
                    function(tx5, results){
                        
                    }
                );  
            },
            function(error){},
            function(){}
        );
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "ALTER TABLE cierre ADD CorreoCuenta text",
                    [],
                    function(tx5, results){
                        
                    }
                );  
            },
            function(error){},
            function(){}
        );
        $("#evaluacion").hide();
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql( 
                  "SELECT cu.NivelRiesgo, COUNT(*) AS malas, cl.Cliente FROM Cuestionarios cu INNER JOIN Clientes  cl ON cl.IdCte = cu.Idcte WHERE cu.Checkbox = 'false' AND cu.IdCedula = ? AND cu.IdCte = ? GROUP BY cu.NivelRiesgo",
                    [icedula,IdCte],
                    function(tx5, results){
                      //console.log(tx5);
                        
                        var length = results.rows.length;
                       // console.log(length);
                        var malasC = 0;
                        var malasRI = 0;
                        //alert(length);
                        for(var i = 0; i< length; i++){
                            var item = results.rows.item(i);
                            //alert(item.NivelRiesgo);
                             if(item.NivelRiesgo == 'C'){
                                  var malasC = item.malas;
                              }
                              if(item.NivelRiesgo == 'RI'){
                                  var malasRI = item.malas;
                              }
                              var nombre = item.Cliente;
                              var ArCadena = nombre.split(' ');
                              var cliente = ArCadena[0];
                               //$valor[] = (int)$evaluacion['malas'];
                              // var riesgo[i] = item.NivelRiesgo;
                              //$i++;
                          }
                              var ClienteMin = cliente.toLowerCase();
                              //alert(IdCte);
                          if (length > 0 && (ClienteMin == 'dominos' || IdCte == 10000)) {
                            $("#evaluacion").show();
                            if (length == 1) {
                                if (malasRI>0) {
                                  $("#tabEval #Eval1").append("<tr><td  style='text-align: center;'>0</td><td  style='background-color: #F9665E;color: white;text-align: center;'>"+malasRI+"</td></tr>");
                                }else if(malasC > 4){
                                  $("#tabEval #Eval1").append("<tr><td  style='background-color: #F9665E;color: white;text-align: center;'>"+malasC+"</td><td  style='text-align: center;'>"+malasRI+"</td></tr>");
                                }else{
                                $("#tabEval #Eval1").append("<tr><td style='text-align: center;'>"+malasC+"</td><td style='text-align: center;'>0</td></tr>");
                                }
                            }else{
                              if (malasC > 4 && malasRI > 0) {
                                $("#tabEval #Eval1").append("<tr><td style='background-color: #F9665E;color: white;text-align: center;'>"+malasC+"</td><td style='background-color: #F9665E;color: white;text-align: center;'>"+malasRI+"</td></tr>");
                              }else if(malasC > 4 && malasRI == 0){
                                $("#tabEval #Eval1").append("<tr><td style='background-color: #F9665E;color: white;text-align: center;'>"+malasC+"</td><td style='text-align: center;'>0</td></tr>");
                              }else if(malasRI > 0 && (malasC > 0 && malasC <5) ){
                                $("#tabEval #Eval1").append("<tr><td style='text-align: center;'>"+malasC+"</td><td style='background-color: #F9665E;color: white;text-align: center;'>"+malasRI+"</td></tr>");
                              }
                            }
                          }
                          
                             

                    }
                );  
            },
            function(error){
              
              databaseHandler.db.transaction(
                                function(tx5){
                                    tx5.executeSql(
                                        "SELECT  cl.Cliente FROM Cuestionarios cu INNER JOIN Clientes  cl ON cl.IdCte = cu.Idcte where cu.IdCedula = ? AND cu.IdCte = ? LIMIT 1",
                                        [icedula,IdCte],
                                        function(tx5, results){
                                          var length = results.rows.length;
                                          var item2 = results.rows.item(0);
                                          var nombre = item2.Cliente;
                                          var ArCadena = nombre.split(' ');
                                          var cliente = ArCadena[0];
                                          var ClienteMin = cliente.toLowerCase();
                                          //alert(ClienteMin);
                                          if (ClienteMin == 'dominos' || IdCte == 10000) {
                                            $("#evaluacion").show();
                                            $("#tabEval #Eval1").append("<tr><td style='text-align: center;'>0</td><td style='text-align: center;'>0</td></tr>");
                                          }

                                            
                                        }
                                    );  
                                },
                                function(error){},
                                function(){}
                            );
            },
            function(){}
        );
        
        //Datos generales e imagen
        databaseHandler.db.transaction(
            function(tx5){

                tx5.executeSql(
                    "SELECT d.NomComercial, d.NomContacto, d.Telefono, d.Email, d.Cliente, d.Estatus, c.Imagen, c.IdCte FROM Cedula as c  INNER JOIN Clientes as d ON c.IdCte = d.IdCte WHERE IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        var item2 = results.rows.item(0);
                        $("#num").html(item2.IdCte);
                        $("#cli").html(item2.Cliente);
                        $("#nom").html(item2.IdCte);
                        $("#contac").html(item2.NomContacto);
                        $("#tel").html(item2.Telefono);
                        $("#nomcom").html(item2.NomComercial);
                        $("#email").html(item2.Email);
                        $("#imagya").html("<img src='"+item2.Imagen+"'width='70' height='70'>");
                        if(item2.Estatus == 1 || item2.Estatus == 'Activo'){
                            var EstN = "Activo";
                        } else {
                            var EstN = "Bloqueado";
                        }
                        
                        $("#estat").html(EstN);  
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove(); 

                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
      
        
        //equipos
        databaseHandler.db.transaction(
            function(tx1){

                tx1.executeSql(
                    "Select * from ced_equipos where IdCedula= ?",
                    [icedula],
                    function(tx, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item = results.rows.item(i);

                            if(item.checkBox == "Equipo en buen estado"){
                             // $("#FEquipos").append("<div class='card demo-facebook-card'><div class='card-content card-content-padding' style='text-align: center;'><p style='text-align: center;'><font color='green'>"+item.checkBox+"</font></p><p><center><img src='"+item.ImgPrd+"' width='120px' height='90px;'/></center></p><p class='likes'>Comentario: "+item.Comentario+"</p> </div></div>");
                             if(item.ImgPrd == ''){
                                $("#FEquipos").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>"+ item.IdPrd + " "+unescape(item.Descripcion) +"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'><font color='green'>"+item.checkBox+"</font></p><div class='card-content card-content-padding' align='center'></div> <p class='likes'>Comentario: "+item.Comentario+"</p>  </div> <div class='card-footer'><a href='#'>Cantidad: "+item.Cantidad+"</a><a href='#' >Ubicacion: "+item.Ubicacion+"</a></div></div>");  
                             } else {
                                $("#FEquipos").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>"+ item.IdPrd + " "+unescape(item.Descripcion) +"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'><font color='green'>"+item.checkBox+"</font></p><div class='card-content card-content-padding' align='center'> <img src='"+ item.ImgPrd +"' style='width: 120px; height: 90px;'/></div> <p class='likes'>Comentario: "+item.Comentario+"</p>  </div> <div class='card-footer'><a href='#'>Cantidad: "+item.Cantidad+"</a><a href='#' >Ubicacion: "+item.Ubicacion+"</a></div></div>");
                             }
                              
                              $('.preloader').remove();
                              $('.infinite-scroll-preloader').remove();
                            }else{
                              if(item.Tickets == 1){$NT = "Daño del equipo por uso normal";}
                              if(item.Tickets == 2){$NT = "Equipo dañado por descuido";}
                              if(item.Tickets == 3){$NT = "Mantenimiento preventivo"}
                              $("#FEquipos").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>"+ item.IdPrd + " "+unescape(item.Descripcion) +"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'>"+$NT+"</p><div class='card-content card-content-padding' align='center'> <img src='"+ item.ImgPrd +"' style='width: 120px; height: 90px;'/></div> <p class='likes'>Comentario: "+item.Comentario+"</p>  </div> <div class='card-footer'><a href='#'>Cantidad: "+item.Cantidad+"</a><a href='#' >Ubicacion: "+item.Ubicacion+"</a></div></div>");
                              $('.preloader').remove();
                              $('.infinite-scroll-preloader').remove();
                            }
                            
                            
                        }
                    },
                    function(tx, error){
                        console.log("Error al consultar: " + error.message);
                    }
                );
                console.log("Consulta correcta");
            },
            function(error){},
            function(){}
        );
       

        //IMAGEN
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "Select * from imagen where IdCedula = ? AND (IdTipoImagen != 3 AND IdTipoImagen != 5);",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                          var item2 = results.rows.item(i);
                          
                            if(item2.IdTipoImagen == 1){
                                TipoImagen = "Wallchart";
                            } 
                            if(item2.IdTipoImagen == 2){
                                TipoImagen = "Etiqueta";
                            }
                            if(item2.IdTipoImagen == 4){
                                TipoImagen = "Carpeta del cliente";
                            }
                            if(item2.checkBox == 1){ var Nbueno = "Imagen en buen estado"; }
                            if(item2.checkBox == 2){ var Nbueno = "Imagen en mal estado"; }
                            if(item2.FotoImagen ==''){
                                $("#FImagen").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>"+ TipoImagen +"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'><font color='green'>"+Nbueno+"</font></p><div class='item-media' align='center'></div> <p class='likes'>Comentario: "+item2.Comentario+"</p>  </div> <div class='card-footer'><a href='#'>Cantidad: "+item2.Cantidad+"</a><a href='#' >Ubicacion: "+item2.Ubicacion+"</a></div></div>");
                            } else {
                                $("#FImagen").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>"+ TipoImagen +"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'><font color='green'>"+Nbueno+"</font></p><div class='item-media' align='center'><img src='"+item2.FotoImagen +"' style='width: 120px; height: 90px;'/></div> <p class='likes'>Comentario: "+item2.Comentario+"</p>  </div> <div class='card-footer'><a href='#'>Cantidad: "+item2.Cantidad+"</a><a href='#' >Ubicacion: "+item2.Ubicacion+"</a></div></div>");    
                            }
                            
                            $('.preloader').remove();
                            $('.infinite-scroll-preloader').remove();  
                          //}                      
                        }
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
       

        //Entrenamiento
        databaseHandler.db.transaction(
            function(tx5){

                tx5.executeSql(
                    "Select * from entrenamiento where IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);
                            if(item2.ImagenFirma ==''){
                                $("#FEntrenamiento").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>Tema de capacitacion:  "+item2.TemaCapacitacion+"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'>Persona capacitada:  "+item2.PersonaCapacitada+"</p><div class='card-content card-content-padding' align='center'></div> <p class='likes'>Puesto: "+item2.Puesto+"</p>  </div> <div class='card-footer'><a href='#'>Comentarios: "+item2.Comentario+"</a></div>   </div>");
                            }else {
                                $("#FEntrenamiento").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>Tema de capacitacion:  "+item2.TemaCapacitacion+"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'>Persona capacitada:  "+item2.PersonaCapacitada+"</p><div class='card-content card-content-padding' align='center'> <img src='"+ item2.ImagenFirma +"' style='width: 120px; height: 90px;'/></div> <p class='likes'>Puesto: "+item2.Puesto+"</p>  </div> <div class='card-footer'><a href='#'>Comentarios: "+item2.Comentario+"</a></div>   </div>");    
                            }
                            
                            $('.preloader').remove();
                            $('.infinite-scroll-preloader').remove();
                        }    
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
        
         
         //inventario
         databaseHandler.db.transaction(
            function(tx5){

                tx5.executeSql(
                    "Select * from tomaInventario where IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                        var item2 = results.rows.item(i);
                        if(item2.ImgAlmacen == ''){
                            $("#FAlmacen").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>Observaciones: "+item2.Observaciones+"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'></p><div class='item-media' align='center'></div></div>   </div>");
                        }else {
                            $("#FAlmacen").append("<div class='card demo-facebook-card'> <div class='card-header'><div class='demo-facebook-name'  style='text-align: center; font-weight: bold;'>Observaciones: "+item2.Observaciones+"</div><div class='demo-facebook-date'></div>  </div> <div class='card-content card-content-padding' style='text-align: center;'> <p style='text-align: center;'></p><div class='item-media' align='center'><img src='"+item2.ImgAlmacen +"' style='width: 120px; height: 90px;'/></div></div>   </div>");                            
                        }
                        
                        
                        }
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove();
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
         
        
        //productos inventario
        //Cargar el contenido si lo tiene
        //PEDIDO
        databaseHandler.db.transaction(
            function(tx5){

                tx5.executeSql(
                    "Select * from pedido where IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);
                              $("#TabProductos2 #IProd").append("<tr><td style='text-align: center;'>" + item2.IdPrd + "</td><td style='text-align: center;'>" + item2.Descripcion + "</td><td style='text-align: center;'>"+ item2.Inventario + "</td><td style='text-align: center;'>" + item2.CanSolicitada + "</td><td style='text-align: center;'>" + item2.Comentario + "</td></tr>");
                        }
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove();
                        
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );

        //OBSERVACIONES PEDIDO
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "Select * from ObservacionesPedido where IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);
                              $("#ObserPe").append(item2.Observaciones);
                        }
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove();
                        
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
     
        
        //nuevos productos
        
         databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "Select * from prodnvos where IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);
                           
                           $("#tablaPNvo1 #prodNew1").append("<tr><td>" + item2.IdPrd + "</td><td>" + item2.Descripcion + "</td><td>"+ item2.Uso + "</td></tr>");
                            
                        }
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove();
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        ); 

         $(".spanBlanco").change(function(){
            if ($(this).val()=="") {
                 $(this).css("background-color", "#ffffff");
            } else {
                 $(this).css("background-color", "#E0F8F7");
            }
        });
        
         var ratings = document.getElementsByClassName('rating');
            for (var i = 0; i < ratings.length; i++) {
                var r = new SimpleStarRating(ratings[i]);
                ratings[i].addEventListener('rate', function(e) {
                $("#eval").val(e.detail);
                });
            }
        //mostrar imagen del cliente
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "Select * from imagen where IdCedula = ? AND (IdTipoImagen = 3 OR IdTipoImagen = 5) ORDER BY IdTipoImagen DESC",
                    [icedula],
                    function(tx5, results){
                      var length = results.rows.length;
                      for(var i = 0; i< length; i++){
                        var item2 = results.rows.item(i);
                        if(item2.IdTipoImagen == 3){
                          var nomImg = "";    
                        }
                        if(item2.IdTipoImagen == 5){
                          var nomImg = "Concentraci&oacute;n de Equipos";    
                        }
                        if(item2.FotoImagen != ''){
                          $("#imgCte").append("<div class='card'> <div class='card-header'><center><strong>"+nomImg+"</strong></center><br/>Ubicacion: "+ item2.Ubicacion+"</div><div class='card-content card-content-padding'><img src='"+ item2.FotoImagen +"' style='width: 70px; height: 90px;'> </div><div class='card-footer' style='text-align: right;'>Cantidad: "+ item2.Cantidad+"<br/>Comentario: "+ item2.Comentario +"</div></div>");
                        }else { 
                          $("#imgCte").append("<div class='card'> <div class='card-header'><center>"+nomImg+"</center><br/>Ubicacion: "+ item2.Ubicacion+"</div><div class='card-content card-content-padding'> </div><div class='card-footer' style='text-align: right;'>Cantidad: "+ item2.Cantidad+"<br/>Comentario: "+ item2.Comentario +"</div></div>");    
                        }
                      }
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        ); 

        $(".cambio").change(function(){
            if ($('input[name="estado"]:checked').val() == 'no') {
              $(".cuenta").hide();
            }
            if($('input[name="estado"]:checked').val() == 'si'){
              $(".cuenta").show();
            } 
        });

        //Datos cierre
        databaseHandler.db.transaction(
            function(tx5){
                tx5.executeSql(
                    "SELECT * FROM cierre WHERE IdCedula = ?",
                    [icedula],
                    function(tx5, results){
                        var length = results.rows.length;
                        for(var i = 0; i< length; i++){
                            var item2 = results.rows.item(i);

                            $("#NombreFirma").val(item2.NombreFirma);
                            $("#text2").val(item2.coment);
                            $("#signate").val(item2.cfirma);
                            $("#eval").val(item2.eval);
                        }
                        $('.preloader').remove();
                        $('.infinite-scroll-preloader').remove();
                    },
                    function(tx5, error){
                        console.log("Error al guardar registro: " + error.message);
                    }
                );  
            },
            function(error){},
            function(){}
        );
      
        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady() {
            navigator.geolocation.getCurrentPosition(onSuccess, onError);
        }
        function onSuccess(position) {
            var element = document.getElementById('geolocation');
            $('#geolocation').val(position.coords.latitude+','+position.coords.longitude);
        }
        function onError(error) {
            alert('Error en la Localización');
        }
      }
    }
  }
</script>